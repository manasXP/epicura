---
tags: [epicura, development, repositories, git]
created: 2026-02-16
aliases: [Repository Plan, Repo Plan]
---

> [!info] Review History
> | Date | Author | Change |
> |------|--------|--------|
> | 2026-02-16 | Manas Pradhan | Initial version — 6 repositories |

# Repository Plan

Six repositories covering all Epicura subsystems: documentation + PCB design, firmware, device software, cloud API + admin portal, and mobile apps.

## Repository Overview

| Repository | Language / Stack | Primary Epics | Owner |
|-----------|-----------------|---------------|-------|
| `epicura` | Markdown + KiCAD 8 | All (docs), PCB | All team / PCB Engineer |
| `epicura-firmware` | C (FreeRTOS, STM32 HAL, MISRA subset) | EMB, THR, ARM | Embedded Engineer |
| `epicura-cm5` | Python (Docker Compose) | EMB, CV, RCP, UI | Software Engineer |
| `epicura-api` | TypeScript (Fastify + Next.js monorepo) | BE, ADM | Backend + Web Engineer |
| `epicura-ios` | Swift (SwiftUI, CoreBluetooth) | IOS | iOS Developer |
| `epicura-android` | Kotlin (Jetpack Compose, CompanionDeviceManager) | AND | Android Developer |

---

## Repository Details

### 1. epicura (this repository)

**Purpose:** Project documentation, specifications, project management, and PCB design files. Single source of truth for all non-code artifacts.

**Already exists** as the current Obsidian vault / git repo.

```
epicura/
├── docs/                              # Structured documentation (35+ files)
│   ├── 01-Overview/
│   ├── 02-Hardware/
│   ├── ...
│   └── 13-ProjectManagement/
│       ├── epics/                     # 12 epic files
│       └── sprints/                   # 12 sprint files
├── research/                          # Market research and planning
├── pcb/                               # KiCAD PCB design files
│   ├── controller-board/
│   │   ├── controller-board.kicad_pro
│   │   ├── controller-board.kicad_sch
│   │   ├── controller-board.kicad_pcb
│   │   ├── fp-lib-table
│   │   └── gerbers/
│   │       ├── controller-board-F_Cu.gbr
│   │       ├── controller-board-B_Cu.gbr
│   │       ├── BOM.csv
│   │       └── CPL.csv               # Pick-and-place
│   ├── driver-board/
│   │   ├── driver-board.kicad_pro
│   │   ├── driver-board.kicad_sch
│   │   ├── driver-board.kicad_pcb
│   │   ├── fp-lib-table
│   │   └── gerbers/
│   ├── libraries/
│   │   ├── epicura-symbols.kicad_sym  # Custom schematic symbols
│   │   └── epicura-footprints.pretty/ # Custom footprints
│   └── datasheets/                    # Component datasheets (PDF)
├── __init.md                          # Project definition
├── __todo.md                          # Task tracking
└── CLAUDE.md                          # AI coding assistant context
```

**Conventions:**
- Documentation in Markdown with Obsidian wiki-link syntax
- PCB files in KiCAD 8 format under `pcb/`
- Gerbers exported and committed for each fabrication order
- Datasheets stored alongside PCB files for reference
- Changes reviewed via PR for significant updates

**CI:** KiCAD ERC/DRC automated check on PR (kicad-cli) for `pcb/` changes

---

### 2. epicura-firmware

**Purpose:** STM32G474RE real-time control firmware — PID, servo, sensors, CAN bus, dispensers, safety.

```
epicura-firmware/
├── Core/
│   ├── Inc/                           # Header files
│   │   ├── main.h
│   │   ├── pid_controller.h
│   │   ├── servo_driver.h
│   │   ├── can_interface.h
│   │   ├── dispenser_asd.h
│   │   ├── dispenser_cid.h
│   │   ├── dispenser_sld.h
│   │   ├── sensor_manager.h
│   │   ├── safety_manager.h
│   │   ├── spi_protocol.h
│   │   └── calibration.h
│   └── Src/                           # Source files (matching headers)
├── Drivers/
│   ├── STM32G4xx_HAL_Driver/          # STM32 HAL (generated by CubeMX)
│   └── CMSIS/                         # ARM CMSIS headers
├── Middlewares/
│   └── Third_Party/FreeRTOS/          # FreeRTOS kernel
├── .ioc                               # STM32CubeMX project file
├── Makefile                           # Build via arm-none-eabi-gcc
├── STM32G474RETx_FLASH.ld             # Linker script
├── openocd.cfg                        # Debug/flash config
├── .github/
│   └── workflows/ci.yml              # Build verification
└── README.md
```

**Build toolchain:** arm-none-eabi-gcc, STM32CubeIDE (optional), OpenOCD for flashing
**CI:** Build check on PR (compile only, no hardware-in-loop)
**Branch strategy:** `main` (release), `develop` (integration), feature branches

---

### 3. epicura-cm5

**Purpose:** All CM5-side software — Docker Compose orchestration of 6 services running on Yocto Linux.

```
epicura-cm5/
├── docker-compose.yml                 # All 6 services
├── docker-compose.dev.yml             # Dev overrides (volumes, debug ports)
├── services/
│   ├── recipe-engine/
│   │   ├── Dockerfile
│   │   ├── requirements.txt
│   │   ├── src/
│   │   │   ├── main.py
│   │   │   ├── parser.py             # YAML recipe parser
│   │   │   ├── state_machine.py      # Cooking FSM
│   │   │   ├── dispenser.py          # Dispensing orchestrator
│   │   │   └── sync.py               # Cloud recipe sync
│   │   ├── recipes/                   # Sample YAML recipes
│   │   └── tests/
│   ├── cv-pipeline/
│   │   ├── Dockerfile
│   │   ├── requirements.txt
│   │   ├── src/
│   │   │   ├── main.py
│   │   │   ├── camera.py             # IMX219 capture via picamera2
│   │   │   ├── preprocessor.py       # OpenCV ROI, resize, normalize
│   │   │   ├── classifier.py         # TFLite inference wrapper
│   │   │   └── detector.py           # Stage detection + anomaly alerts
│   │   ├── models/                    # .tflite model files
│   │   └── tests/
│   ├── kivy-ui/
│   │   ├── Dockerfile
│   │   ├── requirements.txt
│   │   ├── src/
│   │   │   ├── main.py
│   │   │   ├── screens/              # home, recipe_list, recipe_detail, cooking, settings
│   │   │   ├── widgets/              # temp_gauge, timer, camera_feed, alert_banner
│   │   │   └── assets/               # fonts, icons, images
│   │   └── tests/
│   ├── cm5-bridge/
│   │   ├── Dockerfile
│   │   ├── requirements.txt
│   │   ├── src/
│   │   │   ├── main.py
│   │   │   ├── spi_driver.py         # SPI master via spidev
│   │   │   ├── protocol.py           # Binary protocol + CRC16
│   │   │   └── health.py             # Heartbeat + timeout detection
│   │   └── tests/
│   ├── postgres/
│   │   ├── init.sql                   # Schema migration
│   │   └── seed.sql                   # Sample data
│   └── mosquitto/
│       └── mosquitto.conf             # Local broker + cloud bridge config
├── yocto/
│   ├── meta-epicura/                  # Custom Yocto BSP layer
│   │   ├── conf/
│   │   ├── recipes-core/             # Docker, swupdate, connectivity
│   │   └── recipes-epicura/          # Epicura-specific packages
│   └── build-image.sh                # Image build script
├── scripts/
│   ├── flash-emmc.sh                  # Flash CM5 eMMC
│   ├── factory-provision.sh           # Factory provisioning
│   └── ota-build.sh                   # Build .swu update image
├── .github/
│   └── workflows/
│       ├── ci.yml                     # Lint + test all services
│       └── build-image.yml            # Yocto image build (manual trigger)
└── README.md
```

**Build:** `docker compose build` for services; Yocto bitbake for OS image
**CI:** Lint (ruff) + pytest for each Python service on PR
**Branch strategy:** `main` (release), `develop`, feature branches

---

### 4. epicura-api

**Purpose:** Cloud API server and admin portal as a TypeScript monorepo — shared types, validation schemas, and tooling between Fastify backend and Next.js admin dashboard.

```
epicura-api/
├── packages/
│   ├── types/                         # Shared TypeScript interfaces
│   │   ├── src/
│   │   │   ├── recipe.ts
│   │   │   ├── device.ts
│   │   │   ├── user.ts
│   │   │   └── index.ts
│   │   ├── package.json
│   │   └── tsconfig.json
│   └── validators/                    # Shared Zod schemas
│       ├── src/
│       │   ├── recipe.ts
│       │   ├── device.ts
│       │   ├── auth.ts
│       │   └── index.ts
│       ├── package.json
│       └── tsconfig.json
├── apps/
│   ├── api/                           # Fastify API server
│   │   ├── src/
│   │   │   ├── app.ts                 # Fastify initialization
│   │   │   ├── routes/
│   │   │   │   ├── auth.ts            # Register, login, refresh, logout
│   │   │   │   ├── recipes.ts         # CRUD, search, versioning
│   │   │   │   ├── devices.ts         # Register, claim, telemetry, commands
│   │   │   │   └── users.ts           # Profile, history, preferences
│   │   │   ├── services/
│   │   │   │   ├── mqtt-bridge.ts     # Telemetry ingestion, command dispatch
│   │   │   │   └── upload.ts          # Presigned URL generation (S3/R2)
│   │   │   ├── db/
│   │   │   │   ├── schema.ts          # Drizzle ORM schema
│   │   │   │   └── migrations/
│   │   │   ├── middleware/
│   │   │   │   ├── auth.ts            # JWT verification
│   │   │   │   └── admin.ts           # Admin role guard
│   │   │   └── lib/
│   │   │       ├── mqtt.ts
│   │   │       └── logger.ts          # Pino structured logging
│   │   ├── tests/
│   │   ├── Dockerfile
│   │   ├── package.json
│   │   └── tsconfig.json
│   └── admin/                         # Next.js admin portal
│       ├── src/
│       │   ├── app/
│       │   │   ├── layout.tsx         # Root layout with sidebar
│       │   │   ├── page.tsx           # Dashboard home
│       │   │   ├── login/
│       │   │   ├── recipes/           # List, create, edit (Monaco YAML editor)
│       │   │   ├── devices/           # List, detail, telemetry charts
│       │   │   └── users/             # List, detail, roles
│       │   ├── components/
│       │   │   ├── ui/                # shadcn/ui components
│       │   │   ├── recipe-editor.tsx   # Monaco YAML editor wrapper
│       │   │   └── telemetry-chart.tsx # Recharts time-series
│       │   ├── lib/
│       │   │   ├── api.ts             # Fetch client with JWT
│       │   │   ├── auth.ts            # Session management
│       │   │   └── utils.ts
│       │   └── types/                 # Re-exports from @epicura/types
│       ├── public/
│       ├── next.config.ts
│       ├── tailwind.config.ts
│       ├── package.json
│       └── tsconfig.json
├── turbo.json                         # Turborepo pipeline config
├── pnpm-workspace.yaml                # pnpm workspace definition
├── package.json                       # Root package.json
├── tsconfig.base.json                 # Shared TypeScript config
├── docker-compose.yml                 # Local dev (PostgreSQL + Redis + Mosquitto)
├── drizzle.config.ts
├── .github/
│   └── workflows/
│       ├── ci.yml                     # Lint + type-check + test (all packages)
│       ├── deploy-api.yml             # Deploy Fastify API
│       └── deploy-admin.yml           # Deploy Next.js to Vercel
└── README.md
```

**Monorepo tooling:** Turborepo + pnpm workspaces
**Shared packages:**
- `@epicura/types` — TypeScript interfaces for all API request/response shapes
- `@epicura/validators` — Zod schemas shared between API validation and admin form validation

**API runtime:** Node.js 20 LTS, Fastify 5, Drizzle ORM, PostgreSQL 16
**Admin runtime:** Next.js 15, React 19, Tailwind CSS, shadcn/ui, TanStack Table

**CI:** `turbo run lint typecheck test build` on PR (runs all packages in parallel)
**Deployment:**
- API: Railway / Render / VPS with Docker
- Admin: Vercel (auto-deploy on push to main)

**Branch strategy:** `main` (production), `staging`, feature branches

---

### 5. epicura-ios

**Purpose:** iOS companion app — BLE pairing, WiFi provisioning, recipe browsing, live cooking, user profile.

```
epicura-ios/
├── Epicura/
│   ├── App/
│   │   ├── EpicuraApp.swift           # @main entry point
│   │   └── ContentView.swift          # Tab bar navigation
│   ├── Features/
│   │   ├── Auth/                       # Login, Register ViewModels + Views
│   │   ├── Home/                       # Device status, quick actions
│   │   ├── BLE/                        # BLE scanning, pairing, WiFi provisioning
│   │   ├── Recipes/                    # List, detail, search, favorites
│   │   ├── Cooking/                    # Live stream, status, controls
│   │   └── Profile/                    # Settings, history, preferences
│   ├── Services/
│   │   ├── APIClient.swift             # URLSession + JWT management
│   │   ├── BLEManager.swift            # CoreBluetooth wrapper
│   │   ├── WebSocketClient.swift       # Camera stream
│   │   └── KeychainService.swift       # Secure token storage
│   ├── Models/                         # Codable data models
│   ├── Components/                     # Reusable SwiftUI views
│   └── Resources/
│       └── Assets.xcassets
├── EpicuraTests/
├── EpicuraUITests/
├── Epicura.xcodeproj
├── .swiftlint.yml
├── .github/
│   └── workflows/
│       ├── ci.yml                      # SwiftLint + build + test
│       └── cd.yml                      # Fastlane → TestFlight
├── fastlane/
│   ├── Appfile
│   └── Fastfile
└── README.md
```

**Requirements:** Xcode 16+, iOS 17+ deployment target, SwiftUI, async/await
**CI:** SwiftLint + xcodebuild + XCTest on PR
**CD:** Fastlane → TestFlight on tag push
**Branch strategy:** `main` (release), `develop`, feature branches

---

### 6. epicura-android

**Purpose:** Android companion app — mirroring iOS functionality with platform-native implementations.

```
epicura-android/
├── app/
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/com/epicura/
│   │   │   │   ├── EpicuraApp.kt             # Application class + Hilt
│   │   │   │   ├── MainActivity.kt            # Single activity + NavHost
│   │   │   │   ├── ui/
│   │   │   │   │   ├── auth/                  # Login, Register
│   │   │   │   │   ├── home/                  # Device status
│   │   │   │   │   ├── ble/                   # BLE scan, pair, WiFi provision
│   │   │   │   │   ├── recipes/               # List, detail, search, favorites
│   │   │   │   │   ├── cooking/               # Live stream, status, controls
│   │   │   │   │   └── profile/               # Settings, history, preferences
│   │   │   │   ├── data/
│   │   │   │   │   ├── api/                   # Retrofit interfaces
│   │   │   │   │   ├── local/                 # Room database
│   │   │   │   │   └── repository/            # Data layer
│   │   │   │   ├── di/                        # Hilt modules
│   │   │   │   └── util/
│   │   │   ├── res/
│   │   │   └── AndroidManifest.xml
│   │   └── test/                              # Unit tests
│   └── build.gradle.kts
├── build.gradle.kts                           # Root build file
├── settings.gradle.kts
├── gradle.properties
├── .editorconfig
├── .github/
│   └── workflows/
│       ├── ci.yml                             # ktlint + build + test
│       └── cd.yml                             # Fastlane → Play internal
├── fastlane/
│   ├── Appfile
│   └── Fastfile
└── README.md
```

**Requirements:** Android Studio, SDK 28+ (Android 9), Kotlin 2.0, Jetpack Compose
**CI:** ktlint + Gradle build + JUnit on PR
**CD:** Fastlane → Play internal track on tag push
**Branch strategy:** `main` (release), `develop`, feature branches

---

## Cross-Repository Dependencies

```
epicura                (docs + PCB design — standalone)
       │
       ▼ (PCB fabrication produces hardware)
epicura-firmware       (runs on STM32, no code deps on other repos)
       │
       ▼ (SPI protocol spec shared via epicura docs)
epicura-cm5            (runs on CM5, calls firmware via SPI)
       │
       ▼ (MQTT topics + REST API contracts shared via epicura docs)
epicura-api            (cloud API + admin portal monorepo)
       │
       ├──▶ epicura-ios        (REST API client)
       └──▶ epicura-android    (REST API client)
```

**Shared contracts** (no code sharing, contracts defined in `epicura` docs):
- SPI binary protocol spec → between `epicura-firmware` and `epicura-cm5`
- MQTT topic definitions → between `epicura-cm5` and `epicura-api`
- REST API OpenAPI spec → between `epicura-api` and all frontend repos
- BLE service/characteristic UUIDs → between `epicura-firmware` and mobile repos

**Shared types** (code sharing within `epicura-api` monorepo):
- `@epicura/types` — TypeScript interfaces used by both `apps/api` and `apps/admin`
- `@epicura/validators` — Zod schemas used for API validation and admin form validation

---

## Git Conventions (All Repos)

### Branch Strategy

| Branch | Purpose | Protection |
|--------|---------|------------|
| `main` | Production / release | PR required, CI must pass |
| `develop` | Integration (firmware, cm5, mobile only) | PR required |
| `feature/*` | Feature work | No protection |
| `fix/*` | Bug fixes | No protection |

### Commit Messages

Use [Conventional Commits](https://www.conventionalcommits.org/):

```
feat(pid): implement anti-windup for PID controller
fix(ble): handle BLE disconnect during WiFi provisioning
docs(recipe): add YAML schema specification
chore(ci): update GitHub Actions to Node 20
```

### PR Template

All repos include a PR template:
- Summary of changes
- Related epic/story ID (e.g., `THR-PID.01`)
- Testing performed
- Checklist: CI passes, docs updated, no secrets committed

---

## GitHub Organization

**Organization:** `epicura-robotics` (or personal account for prototype phase)

**Repository visibility:** Private (all repos during development)

**GitHub features to enable:**
- **GitHub Issues** — Bug tracking and task management, linked to story IDs (e.g., `THR-PID.01`). Use issue labels for epic (`epic:THR`), priority (`P0`, `P1`, `P2`), and type (`bug`, `feature`, `chore`).
- **GitHub Projects** — Kanban boards for sprint planning and tracking. One project board per sprint with columns: Backlog → In Progress → In Review → Done. Stories and bugs flow through the board during each sprint.
- **GitHub Actions** — CI/CD pipelines for all repos
- **Branch protection rules** — Required on `main`: PR required, CI must pass, 1 approval

---

## Creation Order

Repositories should be created in this order, matching the epic dependency chain:

1. **epicura** — Already exists (add `pcb/` directory for PCB design at Week -6)
2. **epicura-firmware** — Sprint 1 (Week 1): STM32 development begins
3. **epicura-cm5** — Sprint 1 (Week 1): CM5 platform setup begins
4. **epicura-api** — Sprint 5 (Week 9): Cloud backend starts; admin portal added Sprint 10
5. **epicura-ios** — Sprint 8 (Week 15): iOS development starts
6. **epicura-android** — Sprint 8 (Week 15): Android development starts

---

## References

- [[__Workspaces/Epicura/docs/03-Software/01-Tech-Stack|Tech Stack]]
- [[__Workspaces/Epicura/docs/02-Hardware/01-Epicura-Architecture|System Architecture]]
- [[__Workspaces/Epicura/docs/13-ProjectManagement/epics/__init|Epic Index]]
- [[__Workspaces/Epicura/docs/07-Development/01-Prototype-Development-Plan|Prototype Development Plan]]
